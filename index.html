<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BLUOM web search</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="style.css">
<script src="ai.js"></script>
<script>
let indexData = [];

async function loadIndex() {
  try {
    const res = await fetch('index.json');
    indexData = await res.json();
    renderResults('');
  } catch(e){ console.error('Failed to load index.json', e);}
}

function renderResults(query) {
  const main = document.getElementById('results');
  main.innerHTML = '';

  if(!query) query='';

  // --- Sarah AI Overview ---
  const aiDiv = document.createElement('div');
  aiDiv.id = 'sarah-ai';
  aiDiv.innerHTML = `<h2>Sarah AI Overview</h2>
    <div class="ai-box">BLUOM Tech's AI giving insights on "<strong>${query}</strong>"...</div>`;
  main.appendChild(aiDiv);

  updateSarahAI(query); // live AI call

  // --- News Section ---
  const newsDiv = document.createElement('div');
  newsDiv.id = 'news-section';
  const newsItems = indexData.filter(item => item.news_date);
  if(newsItems.length){
    const newsTitle = document.createElement('h2');
    newsTitle.textContent = 'News';
    newsDiv.appendChild(newsTitle);
    newsItems.forEach(item=>{
      if(query && !item.title.toLowerCase().includes(query.toLowerCase())) return;
      const newsItem = document.createElement('div');
      newsItem.className='news-item';
      newsItem.innerHTML = `
        <img src="${item.image}" alt="news">
        <div>
          <a href="${item.url}" target="_blank">${item.title}</a>
          <span class="news-date">${item.news_date.split('T')[0]}</span>
        </div>
      `;
      newsDiv.appendChild(newsItem);
    });
    main.appendChild(newsDiv);
  }

  // --- Web Results ---
  const webDiv = document.createElement('div');
  webDiv.id = 'web-section';
  const webItems = indexData.filter(item => !item.news_date);
  if(webItems.length){
    const webTitle = document.createElement('h2');
    webTitle.textContent = 'Web Results';
    webDiv.appendChild(webTitle);
    webItems.forEach(item=>{
      if(query && !item.title.toLowerCase().includes(query.toLowerCase()) && !item.snippet.toLowerCase().includes(query.toLowerCase())) return;
      const resultItem = document.createElement('div');
      resultItem.className='result-item';
      resultItem.innerHTML = `
        <a href="${item.url}" target="_blank" class="result-title">${item.title}</a>
        <p class="result-snippet">${item.snippet}</p>
        <span class="result-url">${item.url}</span>
      `;
      webDiv.appendChild(resultItem);
    });
    main.appendChild(webDiv);
  }
}

function onSearch(e){
  const val = e.target.value;
  renderResults(val);
}

window.onload = ()=>{
  loadIndex();
  document.getElementById('search-input').addEventListener('input', onSearch);
}
</script>
</head>
<body>
  <header>
    <h1>BLUOM <span>Search</span></h1>
    <input type="text" id="search-input" placeholder="Search BLUOM web...">
  </header>
  <main id="results"></main>
</body>
</html>
