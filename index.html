<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BLUOM Web Search</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" type="image/x-icon" href="assets/favicon.ico">
</head>
<body>

<header>
  <img src="assets/logo.png" alt="BLUOM Logo" id="logo">
  <h1>BLUOM <span class="highlight">Search</span></h1>
  <input type="text" class="search-bar" placeholder="Search the web..." oninput="filterResults()">
</header>

<!-- News / Trending bar -->
<div id="newsFeed" class="news-feed"></div>

<!-- Search results grid -->
<div class="grid" id="resultsGrid"></div>

<script>
// Load JSON data
let results = [];
fetch('index.json')
  .then(res => res.json())
  .then(data => {
    results = data;
    renderNews(data); // show news bar on load
  });

// --- Render news / trending (top 5 by links) ---
function renderNews(list){
  const feed = document.getElementById('newsFeed');
  feed.innerHTML = '';

  const topNews = list.sort((a,b)=> b.links - a.links).slice(0,5);

  topNews.forEach(item => {
    const img = item.image || 'assets/placeholder.png'; // placeholder if no image

    const card = document.createElement('div');
    card.className = 'news-card';
    card.innerHTML = `
      <a href="${item.url}" target="_blank">
        <img src="${img}" alt="News Image" class="news-img">
        <div class="title">${item.title}</div>
      </a>
    `;
    feed.appendChild(card);
  });
}

// --- Render search results ---
function renderResults(list){
  const grid = document.getElementById('resultsGrid');
  grid.innerHTML = '';
  if(list.length === 0){
    grid.innerHTML = '<p class="no-results">No results found.</p>';
    return;
  }
  list.slice(0,50).forEach(item=>{
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <a href="${item.url}" target="_blank">
        <div class="title">${item.title}</div>
        <div class="snippet">${item.snippet || ''}</div>
        <div class="url">${item.url}</div>
      </a>
    `;
    grid.appendChild(card);
  });
}

// --- Filter results on search input ---
function filterResults(){
  const q = document.querySelector('.search-bar').value.toLowerCase();
  const newsFeed = document.getElementById('newsFeed');
  const resultsGrid = document.getElementById('resultsGrid');

  if(!q) {
    // Empty → show news, hide results
    newsFeed.style.display = 'flex';
    resultsGrid.innerHTML = '';
    renderNews(results);
    return;
  }

  // Typing → hide news
  newsFeed.style.display = 'none';

  const filtered = results.filter(item=>{
    return (item.title && item.title.toLowerCase().includes(q)) ||
           (item.snippet && item.snippet.toLowerCase().includes(q));
  });

  renderResults(filtered);
}
</script>

</body>
</html>
